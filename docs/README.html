<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="iac-com-terraform-e-oci">IAC com Terraform e OCI</h1>
<p>Neste reposit√≥rio, vamos aprender a usar o Terraform e a OCI para criar a nossa primeira infra na nuvem.</p>
<p>Este documento tamb√©m est√° dispon√≠vel em <a href="docs/README.pdf">formato PDF</a> e <a href="docs/README.html">formato HTML</a> para que voc√™ possa visualiz√°-lo offline.</p>
<h2 id="tabela-de-conte%C3%BAdos">Tabela de conte√∫dos</h2>
<ul>
<li><a href="#pr%C3%A9-requisitos">Pr√©-requisitos</a></li>
<li><a href="#passo-a-passo">Passo a passo</a></li>
<li><a href="#erros-conhecidos">Erros conhecidos</a></li>
<li><a href="#saiba-mais">Saiba mais</a></li>
</ul>
<h2 id="pr%C3%A9-requisitos">Pr√©-requisitos</h2>
<ul>
<li>Instala√ß√£o do Terraform
<ul>
<li>https://developer.hashicorp.com/terraform/downloads?product_intent=terraform</li>
<li><strong>Usa Windows?</strong> acesse esse <a href="docs/Como%20Instalar%20o%20Terraform%20no%20Windows.pdf">documento</a></li>
</ul>
</li>
<li>Instala√ß√£o do OCI CLI
<ul>
<li>https://docs.oracle.com/pt-br/iaas/Content/API/SDKDocs/cliinstall.htm</li>
</ul>
</li>
<li>Criando usu√°rio na OCI
<ul>
<li>https://docs.oracle.com/pt-br/iaas/Content/GSG/Tasks/addingusers.htm#Add</li>
</ul>
</li>
<li>Realizar login no OCI CLI
<ul>
<li><code>oci setup config</code></li>
</ul>
</li>
</ul>
<h2 id="passo-a-passo">Passo a passo</h2>
<p>Vamos come√ßar a divers√£o! ü•≥</p>
<ol>
<li>
<p>Comece fazendo o clone do reposit√≥rio:</p>
<blockquote>
<p>[!TIP]
Se voc√™ preferir usar o Github √© s√≥ trocar a URL do reposit√≥rio para <code>https://github.com/avanti-dvp/iac-com-terraform-e-oci.git</code></p>
</blockquote>
<pre class="hljs"><code><div>git <span class="hljs-built_in">clone</span> https://gitlab.com/avanti-dvp/iac-com-terraform<span class="hljs-_">-e</span>-oci.git
<span class="hljs-built_in">cd</span> iac-com-terraform<span class="hljs-_">-e</span>-oci
</div></code></pre>
<blockquote>
<p>[!NOTE]
Se voc√™ n√£o tem o Git instalado ou n√£o sabe us√°-lo, sem problema algum, voc√™ pode simplesmente fazer o <a href="https://gitlab.com/avanti-dvp/iac-com-terraform-e-oci/-/archive/main/iac-com-terraform-e-oci-main.zip">download do reposit√≥rio</a> e descompact√°-lo em sua pasta/diret√≥rio de trabalho ou na pasta/diret√≥rio de seu usu√°rio</p>
</blockquote>
</li>
<li>
<p>Vamos abrir o Visual Studio Code no diret√≥rio do reposit√≥rio:</p>
<pre class="hljs"><code><div>code .
</div></code></pre>
</li>
<li>
<p>Dentro do Visual Studio Code, crie um arquivo chamado <code>provider.tf</code>, incluindo esse trecho abaixo nele:</p>
<pre class="hljs"><code><div>terraform {
  required_providers {
    oci = {
      source  = &quot;oracle/oci&quot;
      version = &quot;~&gt; 5.0&quot;
    }
    tls = {
      source  = &quot;hashicorp/tls&quot;
      version = &quot;4.0.5&quot;
    }
    local = {
      source  = &quot;hashicorp/local&quot;
      version = &quot;2.5.1&quot;
    }
  }
}

provider &quot;oci&quot; {
  tenancy_ocid     = var.tenancy_ocid
  user_ocid        = var.user_ocid
  fingerprint      = var.fingerprint
  private_key_path = var.private_key_path
  region           = var.region
}
</div></code></pre>
<blockquote>
<p>[!TIP]
O arquivo <code>provider.tf</code> √© o arquivo que define o provedor que ser√° usado para criar a infraestrutura na nuvem, nesse caso, a AWS.
Este arquivo √© uma conven√ß√£o entre os desenvolvedores, ele √© opcional, mas √© uma boa pr√°tica ter ele.</p>
</blockquote>
</li>
<li>
<p>Agora vamos criar o arquivo <code>network.tf</code>, incluindo esse trecho abaixo nele:</p>
<pre class="hljs"><code><div># Cria uma Virtual Cloud Network (VCN)
resource &quot;oci_core_vcn&quot; &quot;vcn&quot; {
  compartment_id = var.compartment_ocid
  display_name   = &quot;web-vcn&quot;
  cidr_block     = &quot;10.0.0.0/16&quot;
}

# Cria um Internet Gateway para permitir o acesso √† internet
resource &quot;oci_core_internet_gateway&quot; &quot;internet_gateway&quot; {
  compartment_id = var.compartment_ocid
  vcn_id         = oci_core_vcn.vcn.id
  display_name   = &quot;web-ig&quot;
}

# Cria uma Tabela de Rotas para direcionar o tr√°fego para o Internet Gateway
resource &quot;oci_core_route_table&quot; &quot;route_table&quot; {
  compartment_id = var.compartment_ocid
  vcn_id         = oci_core_vcn.vcn.id
  display_name   = &quot;web-rt&quot;

  route_rules {
    destination       = &quot;0.0.0.0/0&quot;
    destination_type  = &quot;CIDR_BLOCK&quot;
    network_entity_id = oci_core_internet_gateway.internet_gateway.id
  }
}

# Cria uma Subnet p√∫blica
resource &quot;oci_core_subnet&quot; &quot;subnet&quot; {
  compartment_id = var.compartment_ocid
  vcn_id         = oci_core_vcn.vcn.id
  display_name   = &quot;web-subnet&quot;
  cidr_block     = &quot;10.0.1.0/24&quot;
  route_table_id = oci_core_route_table.route_table.id
}
</div></code></pre>
<blockquote>
<p>[!TIP]
O arquivo <code>network.tf</code> √© o arquivo que define a cria√ß√£o de rede da OCI.</p>
</blockquote>
</li>
<li>
<p>Agora vamos criar o arquivo <code>security_group.tf</code>, incluindo esse trecho abaixo nele:</p>
<pre class="hljs"><code><div># Cria um Network Security Group (NSG)
resource &quot;oci_core_network_security_group&quot; &quot;web_nsg&quot; {
  compartment_id = var.compartment_ocid
  vcn_id         = oci_core_vcn.vcn.id
  display_name   = &quot;web-server-nsg&quot;
}

# Regra de seguran√ßa para liberar a por`ta 80 (HTTP)
resource &quot;oci_core_network_security_group_security_rule&quot; &quot;allow_http&quot; {
  network_security_group_id = oci_core_network_security_group.web_nsg.id
  direction                 = &quot;INGRESS&quot;
  protocol                  = &quot;6&quot; # TCP
  source                    = &quot;0.0.0.0/0&quot;
  source_type               = &quot;CIDR_BLOCK&quot;

  tcp_options {
    destination_port_range {
      min = 80
      max = 80
    }
  }
}

# Regra de seguran√ßa para liberar a porta 22 (SSH)
resource &quot;oci_core_network_security_group_security_rule&quot; &quot;allow_ssh&quot; {
  network_security_group_id = oci_core_network_security_group.web_nsg.id
  direction                 = &quot;INGRESS&quot;
  protocol                  = &quot;6&quot; # TCP
  source                    = var.meu_ip_publico
  source_type               = &quot;CIDR_BLOCK&quot;

  tcp_options {
    destination_port_range {
      min = 22
      max = 22
    }
  }
}

# Regra de seguran√ßa para liberar todo o tr√°fego de sa√≠da (Egress)
resource &quot;oci_core_network_security_group_security_rule&quot; &quot;allow_egress&quot; {
  network_security_group_id = oci_core_network_security_group.web_nsg.id
  direction                 = &quot;EGRESS&quot;
  protocol                  = &quot;all&quot;
  destination               = &quot;0.0.0.0/0&quot;
  destination_type          = &quot;CIDR_BLOCK&quot;
}
</div></code></pre>
<blockquote>
<p>[!TIP]
O arquivo <code>security_group.tf</code> √© o arquivo que define a cria√ß√£o dos security groups na OCI, ou seja, as regras de seguran√ßa para o acesso externo.</p>
</blockquote>
</li>
<li>
<p>Agora vamos criar o arquivo <code>main.tf</code>, incluindo esse trecho abaixo nele:</p>
<pre class="hljs"><code><div># Obt√©m a lista de dom√≠nios de disponibilidade
data &quot;oci_identity_availability_domains&quot; &quot;ads&quot; {
  compartment_id = var.tenancy_ocid
}

# Obt√©m a imagem mais recente do Oracle Linux
data &quot;oci_core_images&quot; &quot;oracle_linux&quot; {
  compartment_id = var.compartment_ocid
  operating_system = &quot;Oracle Linux&quot;
  operating_system_version = &quot;8&quot;
  shape = &quot;VM.Standard.E2.1.Micro&quot; # Exemplo de shape, ajuste se necess√°rio
  sort_by = &quot;TIMECREATED&quot;
  sort_order = &quot;DESC&quot;
}

# Gera uma chave privada RSA de 4096 bits
resource &quot;tls_private_key&quot; &quot;rsa_key&quot; {
  algorithm = &quot;RSA&quot;
  rsa_bits  = 4096
}

# Salva a chave privada em um arquivo local
resource &quot;local_file&quot; &quot;private_key_pem&quot; {
    content  = tls_private_key.rsa_key.private_key_pem
    filename = &quot;${path.module}/oci-instance-key.pem&quot;
    file_permission = &quot;0600&quot;
}


# Cria a inst√¢ncia de computa√ß√£o
resource &quot;oci_core_instance&quot; &quot;web_server&quot; {
  availability_domain = data.oci_identity_availability_domains.ads.availability_domains[0].name
  compartment_id      = var.compartment_ocid
  display_name        = &quot;WebServer-DVP&quot;
  shape               = &quot;VM.Standard.E2.1.Micro&quot; # Shape &quot;Always Free&quot;

  create_vnic_details {
    subnet_id              = oci_core_subnet.subnet.id
    assign_public_ip       = true
    nsg_ids                = [oci_core_network_security_group.web_nsg.id]
  }

  source_details {
    source_type = &quot;image&quot;
    source_id   = data.oci_core_images.oracle_linux.images[0].id
  }

  metadata = {
    ssh_authorized_keys = tls_private_key.rsa_key.public_key_openssh
    user_data           = base64encode(file(&quot;user_data.sh&quot;))
  }

  tags = {
    Name = &quot;WebServer-DVP&quot;
  }
}
</div></code></pre>
<blockquote>
<p>[!TIP]
O arquivo <code>main.tf</code> √© o arquivo que define a cria√ß√£o da inst√¢ncia na OCI.</p>
</blockquote>
</li>
<li>
<p>Agora vamos criar o arquivo <code>outputs.tf</code>, incluindo esse trecho abaixo nele:</p>
<pre class="hljs"><code><div># Bloco para obter o IP p√∫blico da VNIC da inst√¢ncia
data &quot;oci_core_vnic&quot; &quot;instance_vnic&quot; {
  vnic_id = oci_core_instance.web_server.create_vnic_details[0].id
}


# Bloco para exibir o IP p√∫blico da inst√¢ncia ap√≥s a cria√ß√£o
output &quot;instance_public_ip&quot; {
  description = &quot;IP p√∫blico da inst√¢ncia&quot;
  value       = data.oci_core_vnic.instance_vnic.public_ip_address
}

output &quot;website_url&quot; {
  description = &quot;URL do site provisionado.&quot;
  value       = &quot;http://${data.oci_core_vnic.instance_vnic.public_ip_address}&quot;
}
</div></code></pre>
<blockquote>
<p>[!TIP]
O arquivo <code>outputs.tf</code> √© o arquivo que define as sa√≠das que ser√£o exibidas ap√≥s a cria√ß√£o da infraestrutura, nesse caso, o IP p√∫blico da inst√¢ncia.</p>
</blockquote>
</li>
<li>
<p>Agora vamos criar o arquivo <code>variables.tf</code>, incluindo esse trecho abaixo nele:</p>
<pre class="hljs"><code><div>variable &quot;tenancy_ocid&quot; {
  type        = string
  description = &quot;O OCID da sua Tenancy na OCI.&quot;
}

variable &quot;user_ocid&quot; {
  type        = string
  description = &quot;O OCID do seu usu√°rio na OCI.&quot;
}

variable &quot;fingerprint&quot; {
  type        = string
  description = &quot;O fingerprint da sua chave de API na OCI.&quot;
}

variable &quot;private_key_path&quot; {
  type        = string
  description = &quot;O caminho para a sua chave privada de API da OCI.&quot;
}

variable &quot;region&quot; {
  type        = string
  description = &quot;A regi√£o da OCI para provisionar os recursos.&quot;
  default     = &quot;us-ashburn-1&quot;
}

variable &quot;compartment_ocid&quot; {
  type        = string
  description = &quot;O OCID do compartimento onde os recursos ser√£o criados.&quot;
}

variable &quot;meu_ip_publico&quot; {
  type        = string
  description = &quot;Endere√ßo IP p√∫blico para o Security Group SSH&quot;
  default     = &quot;203.0.113.25/32&quot; # IMPORTANTE: Substitua pelo seu endere√ßo IP p√∫blico
}
</div></code></pre>
<blockquote>
<p>[!TIP]
O arquivo <code>variables.tf</code> √© o arquivo que define as vari√°veis que ser√£o usadas na infraestrutura, nesse caso, o IP p√∫blico para o Security Group SSH.</p>
</blockquote>
</li>
<li>
<p>Precisamos definir o valor de algumas dessas vari√°veis, para isso criaremos um arquivo <code>terraform.tfvars</code> com os valores das vari√°veis.</p>
<pre class="hljs"><code><div>tenancy_ocid     = &quot;ocid1.tenancy.oc1..xxxx&quot;
user_ocid        = &quot;ocid1.user.oc1..xxxx&quot;
fingerprint      = &quot;xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx&quot;
private_key_path = &quot;/caminho/para/sua/chave_privada.pem&quot;
compartment_ocid = &quot;ocid1.compartment.oc1..xxxx&quot;
meu_ip_publico   = &quot;SEU_IP_PUBLICO/32&quot;
</div></code></pre>
</li>
<li>
<p>Agora √© hora de criar o playbook do Ansible para ir√° provisionar a p√°gina</p>
</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configure</span> <span class="hljs-string">Web</span> <span class="hljs-string">Server</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">all</span>
  <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span>         <span class="hljs-comment"># Necess√°rio para instalar pacotes e gerenciar servi√ßos</span>

  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ensure</span> <span class="hljs-string">all</span> <span class="hljs-string">packages</span> <span class="hljs-string">are</span> <span class="hljs-string">up</span> <span class="hljs-string">to</span> <span class="hljs-string">date</span>
      <span class="hljs-attr">yum:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">'*'</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">latest</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Git</span>
      <span class="hljs-attr">yum:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">git</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Nginx</span>
      <span class="hljs-attr">yum:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">'nginx'</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">latest</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Ensure</span> <span class="hljs-string">Nginx</span> <span class="hljs-string">service</span> <span class="hljs-string">is</span> <span class="hljs-string">started</span> <span class="hljs-string">and</span> <span class="hljs-string">enabled</span>
      <span class="hljs-attr">service:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">started</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">yes</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Clone</span> <span class="hljs-string">website</span> <span class="hljs-string">repository</span>
      <span class="hljs-attr">git:</span>
        <span class="hljs-attr">repo:</span> <span class="hljs-string">'https://github.com/avanti-dvp/site-exemplo-aws.git'</span> <span class="hljs-comment"># Pode ser o mesmo repo ou outro</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">'/tmp/website'</span>
        <span class="hljs-attr">clone:</span> <span class="hljs-literal">yes</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">website</span> <span class="hljs-string">files</span> <span class="hljs-string">to</span> <span class="hljs-string">Nginx</span> <span class="hljs-string">document</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">copy:</span>
        <span class="hljs-attr">src:</span> <span class="hljs-string">"/tmp/website/"</span>
        <span class="hljs-attr">dest:</span> <span class="hljs-string">"/usr/share/nginx/html/"</span>
        <span class="hljs-attr">remote_src:</span> <span class="hljs-literal">yes</span> <span class="hljs-comment"># src e dest est√£o na mesma m√°quina</span>
        <span class="hljs-attr">owner:</span> <span class="hljs-string">root</span>
        <span class="hljs-attr">group:</span> <span class="hljs-string">nginx</span>
        <span class="hljs-attr">mode:</span> <span class="hljs-string">'0755'</span>
      <span class="hljs-attr">notify:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">restart</span> <span class="hljs-string">nginx</span>

  <span class="hljs-attr">handlers:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">restart</span> <span class="hljs-string">nginx</span>
      <span class="hljs-attr">service:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">restarted</span>
</div></code></pre>
<ol start="12">
<li>Agora precisamos criar o invent√°rio do Ansible para que ele possa acessar a inst√¢ncia que foi criada pelo Terraform.</li>
</ol>
<pre class="hljs"><code><div>touch inventory
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[all]"</span> &gt;&gt; inventory
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ip_da_instancia ansible_user=opc ansible_ssh_private_key_file=/caminho/para/sua/chave_privada.pem"</span> &gt;&gt; inventory
</div></code></pre>
<ol start="13">
<li>
<p>Boa! terminamos de criar todos os arquivos necess√°rios para a cria√ß√£o da infraestrutura na nuvem.</p>
</li>
<li>
<p>Agora vamos iniciar o fluxo de trabalho do Terraform para criar a infraestrutura na nuvem:</p>
<pre class="hljs"><code><div>terraform init
terraform plan
terraform apply
</div></code></pre>
<blockquote>
<p>[!NOTE]
O comando <code>terraform init</code> inicializa o Terraform e baixa os providers necess√°rios para a cria√ß√£o da infraestrutura na nuvem.
O comando <code>terraform plan</code> cria um plano de execu√ß√£o que mostra as altera√ß√µes que ser√£o feitas na infraestrutura na nuvem.
O comando <code>terraform apply</code> aplica as configura√ß√µes definidas nos arquivos .tf e cria a infraestrutura na nuvem.</p>
</blockquote>
</li>
<li>
<p>Agora vamos rodar o Ansible para configurar a inst√¢ncia da OCI:</p>
<pre class="hljs"><code><div>ansible-playbook -i inventory playbook.yml
</div></code></pre>
<blockquote>
<p>[!NOTE]
O comando <code>ansible-playbook</code> executa o playbook definido no arquivo playbook.yml.
O par√¢metro <code>-i</code> especifica o arquivo de invent√°rio que cont√©m as informa√ß√µes de acesso √† inst√¢ncia da OCI.</p>
</blockquote>
</li>
<li>
<p>Se tudo rodar com sucesso, voc√™ ver√° o IP p√∫blico da inst√¢ncia e a URL do site provisionado, basta acess√°-lo atrav√©s dessa URL no seu navegador para ver o site est√° no ar.</p>
</li>
</ol>
<blockquote>
<p>[!WARNING]
A maioria dos navegadores modernos for√ßa o redirecionamento da p√°gina para HTTPS
Como n√£o subimos o site em HTTPS, a conex√£o n√£o ir√° acontecer
Portanto, para ver o site funcionando, voc√™ precisa adicionar o http:// no come√ßo da URL antes do IP na barra de endere√ßo do seu navegador</p>
</blockquote>
<p>E ele dever√° aparecer dessa forma:</p>
<p><img src="docs/images/site.png" alt="Site no Ar"></p>
<ol start="17">
<li>
<p>Para destruir a infraestrutura na nuvem, execute o comando abaixo:</p>
<pre class="hljs"><code><div>terraform destroy
</div></code></pre>
<blockquote>
<p>[!NOTE]
O comando <code>terraform destroy</code> destr√≥i a infraestrutura na nuvem que foi criada pelo Terraform.
<strong>RECOMENDADO:</strong> Sempre que voc√™ criar uma infraestrutura na nuvem, certifique-se de destru√≠-la quando n√£o estiver mais usando.</p>
</blockquote>
</li>
</ol>
<h2 id="saiba-mais">Saiba mais</h2>
<ul>
<li><a href="https://developer.hashicorp.com/terraform">Documenta√ß√£o do Terraform</a></li>
<li><a href="https://registry.terraform.io/providers/oracle/oci/latest/docs">Documenta√ß√£o do Provider OCI do Terraform</a></li>
<li><a href="https://registry.terraform.io/browse/providers">Lista de Providers do Terraform</a></li>
<li><a href="https://docs.oracle.com/pt-br/iaas/Content/home.htm">Documenta√ß√£o da OCI</a></li>
</ul>

</body>
</html>
